<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/tjwebb/sails-auth"

    >sails-auth (v2.1.3)</a>
</h1>
<h4>Passport-based User Authentication system for sails.js applications.</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth">module sails-auth</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.sails-auth">
            function <span class="apidocSignatureSpan"></span>sails-auth
            <span class="apidocSignatureSpan">(sails)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.SAError">
            function <span class="apidocSignatureSpan">sails-auth.</span>SAError
            <span class="apidocSignatureSpan">(properties)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.</span>AuthController</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.</span>AuthService</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.</span>Passport</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.</span>SAError.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.</span>User</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.</span>UserController</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.</span>index</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.</span>local</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.AuthController">module sails-auth.AuthController</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.AuthController.callback">
            function <span class="apidocSignatureSpan">sails-auth.AuthController.</span>callback
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.AuthController.disconnect">
            function <span class="apidocSignatureSpan">sails-auth.AuthController.</span>disconnect
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.AuthController.logout">
            function <span class="apidocSignatureSpan">sails-auth.AuthController.</span>logout
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.AuthController.provider">
            function <span class="apidocSignatureSpan">sails-auth.AuthController.</span>provider
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.AuthService">module sails-auth.AuthService</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.AuthService.buildCallbackNextUrl">
            function <span class="apidocSignatureSpan">sails-auth.AuthService.</span>buildCallbackNextUrl
            <span class="apidocSignatureSpan">(req)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.Passport">module sails-auth.Passport</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.Passport.beforeCreate">
            function <span class="apidocSignatureSpan">sails-auth.Passport.</span>beforeCreate
            <span class="apidocSignatureSpan">(passport, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.Passport.beforeUpdate">
            function <span class="apidocSignatureSpan">sails-auth.Passport.</span>beforeUpdate
            <span class="apidocSignatureSpan">(passport, next)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.Passport.</span>attributes</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.SAError">module sails-auth.SAError</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.SAError.SAError">
            function <span class="apidocSignatureSpan">sails-auth.</span>SAError
            <span class="apidocSignatureSpan">(properties)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.SAError.super_">
            function <span class="apidocSignatureSpan">sails-auth.SAError.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.SAError.prototype">module sails-auth.SAError.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.SAError.prototype.toJSON">
            function <span class="apidocSignatureSpan">sails-auth.SAError.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.SAError.prototype.toPOJO">
            function <span class="apidocSignatureSpan">sails-auth.SAError.prototype.</span>toPOJO
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">sails-auth.SAError.prototype.</span>status</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">sails-auth.SAError.prototype.</span>summary</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.User">module sails-auth.User</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.User.beforeCreate">
            function <span class="apidocSignatureSpan">sails-auth.User.</span>beforeCreate
            <span class="apidocSignatureSpan">(user, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.User.register">
            function <span class="apidocSignatureSpan">sails-auth.User.</span>register
            <span class="apidocSignatureSpan">(user)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.User.</span>attributes</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.UserController">module sails-auth.UserController</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.UserController.create">
            function <span class="apidocSignatureSpan">sails-auth.UserController.</span>create
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.UserController.me">
            function <span class="apidocSignatureSpan">sails-auth.UserController.</span>me
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.index">module sails-auth.index</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.index.basic">
            function <span class="apidocSignatureSpan">sails-auth.index.</span>basic
            <span class="apidocSignatureSpan">(req, username, password, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.index.oauth">
            function <span class="apidocSignatureSpan">sails-auth.index.</span>oauth
            <span class="apidocSignatureSpan">(req, token, tokenSecret, profile, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.index.oauth2">
            function <span class="apidocSignatureSpan">sails-auth.index.</span>oauth2
            <span class="apidocSignatureSpan">(req, accessToken, refreshToken, profile, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.index.openid">
            function <span class="apidocSignatureSpan">sails-auth.index.</span>openid
            <span class="apidocSignatureSpan">(req, identifier, profile, next)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-auth.index.</span>local</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-auth.local">module sails-auth.local</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.local.connect">
            function <span class="apidocSignatureSpan">sails-auth.local.</span>connect
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.local.createUser">
            function <span class="apidocSignatureSpan">sails-auth.local.</span>createUser
            <span class="apidocSignatureSpan">(_user, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.local.login">
            function <span class="apidocSignatureSpan">sails-auth.local.</span>login
            <span class="apidocSignatureSpan">(req, identifier, password, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-auth.local.register">
            function <span class="apidocSignatureSpan">sails-auth.local.</span>register
            <span class="apidocSignatureSpan">(user, next)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth" id="apidoc.module.sails-auth">module sails-auth</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.sails-auth" id="apidoc.element.sails-auth.sails-auth">
        function <span class="apidocSignatureSpan"></span>sails-auth
        <span class="apidocSignatureSpan">(sails)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sails-auth = function (sails) {
  var hook = new Hook(sails);
  hook.loadConfig(Hook.constructor.name);

  var config = _lodash2[&#x27;default&#x27;].defaults({}, Marlinspike.defaultConfig());
  if (hook.name in sails.config) _lodash2[&#x27;default&#x27;].extend(config.marlinspike, sails.config[hook.name].marlinspike);

  return {
    name: _this.name,
    routes: hook.routes(),
    defaults: function defaults(overrides) {
      return _lodash2[&#x27;default&#x27;].merge(config, hook.defaults(overrides));
    },
    configure: function configure() {
      if (config.marlinspike.services) hook.loadServices();
      if (config.marlinspike.models) hook.loadModels();
      if (config.marlinspike.controllers) hook.loadControllers();
      if (config.marlinspike.policies) hook.loadPolicies();

      hook.configure();
      sails.emit(&#x27;hook:&#x27; + hook.name + &#x27;:configured&#x27;);
    },
    initialize: function initialize(next) {

      hook.initialize(function () {
        sails.emit(&#x27;hook:&#x27; + hook.name + &#x27;:initialized&#x27;);
        next();
      });
    }
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.SAError" id="apidoc.element.sails-auth.SAError">
        function <span class="apidocSignatureSpan">sails-auth.</span>SAError
        <span class="apidocSignatureSpan">(properties)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SAError(properties) {

  // Call superclass (Error)
  SAError.super_.call(this, properties);

  // Merge the properties into the error instance
  properties || (properties = { });
  _.extend(this, properties);

  // Customize the `reason` based on the # of invalid attributes
  // (`reason` may not be overridden)
  var isSingular = this.length === 1;
  this.reason = util.format(&#x27;%d attribute%s %s invalid&#x27;,
    this.length,
    isSingular ? &#x27;&#x27; : &#x27;s&#x27;,
    isSingular ? &#x27;is&#x27; : &#x27;are&#x27;);

  // Always apply the &#x27;E_VALIDATION&#x27; error code, even if it was overridden.
  this.code = &#x27;E_VALIDATION&#x27;;

  // Status may be overridden.
  this.status = properties.status || 400;

  if (this.originalError) {
    if (this.originalError.invalidAttributes) {
      this.invalidAttributes = _.mapValues(this.originalError.invalidAttributes, function(n, k) {
        return _.map(n, function(i) {
          // Set a new message if we have one
          if (_.has(errors, [k, i.rule])) {
            i.message = errors[k][i.rule];
          }

          // Remove all elements but the message
          _.forEach(_.without(_.keys(i), &#x27;message&#x27;), function(key) {
            delete i[key];
          })

          return i;
        })

        return n;
      });
    }

  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.AuthController" id="apidoc.module.sails-auth.AuthController">module sails-auth.AuthController</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.AuthController.callback" id="apidoc.element.sails-auth.AuthController.callback">
        function <span class="apidocSignatureSpan">sails-auth.AuthController.</span>callback
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">callback = function (req, res) {
  var action = req.param(&#x27;action&#x27;);

  function negotiateError (err) {
    if (action === &#x27;register&#x27;) {
      res.redirect(&#x27;/register&#x27;);
    }
    else if (action === &#x27;login&#x27;) {
      res.redirect(&#x27;/login&#x27;);
    }
    else if (action === &#x27;disconnect&#x27;) {
      res.redirect(&#x27;back&#x27;);
    }
    else {
      // make sure the server always returns a response to the client
      // i.e passport-local bad username/email or password
      res.send(403, err);
    }
  }

  sails.services.passport.callback(req, res, function (err, user) {
    if (err || !user) {
      sails.log.warn(user, err);
      return negotiateError(err);
    }

    req.login(user, function (err) {
      if (err) {
        sails.log.warn(err);
        return negotiateError(err);
      }

      req.session.authenticated = true;

      // Upon successful login, optionally redirect the user if there is a
      // `next` query param
      if (req.query.next) {
        var url = sails.services.authservice.buildCallbackNextUrl(req);
        res.status(302).set(&#x27;Location&#x27;, url);
      }

      sails.log.info(&#x27;user&#x27;, user, &#x27;authenticated successfully&#x27;);
      return res.json(user);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
else {
  // make sure the server always returns a response to the client
  // i.e passport-local bad username/email or password
  res.send(403, err);
}
    }

    sails.services.passport.<span class="apidocCodeKeywordSpan">callback</span>(req, res, function (err, user) {
if (err || !user) {
  sails.log.warn(user, err);
  return negotiateError(err);
}

req.login(user, function (err) {
  if (err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.AuthController.disconnect" id="apidoc.element.sails-auth.AuthController.disconnect">
        function <span class="apidocSignatureSpan">sails-auth.AuthController.</span>disconnect
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disconnect = function (req, res) {
  sails.services.passport.disconnect(req, res);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  /**
   * Disconnect a passport from a user
   *
   * @param {Object} req
   * @param {Object} res
   */
  disconnect: function (req, res) {
    sails.services.passport.<span class="apidocCodeKeywordSpan">disconnect</span>(req, res);
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.AuthController.logout" id="apidoc.element.sails-auth.AuthController.logout">
        function <span class="apidocSignatureSpan">sails-auth.AuthController.</span>logout
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">logout = function (req, res) {
  req.logout();
  delete req.user;
  delete req.session.passport;
  req.session.authenticated = false;

  if (!req.isSocket) {
    res.redirect(req.query.next || &#x27;/&#x27;);
  }
  else {
    res.ok();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
   * For more information on logging out users in Passport.js, check out:
   * http://passportjs.org/guide/logout/
   *
   * @param {Object} req
   * @param {Object} res
   */
  logout: function (req, res) {
req.<span class="apidocCodeKeywordSpan">logout</span>();
delete req.user;
delete req.session.passport;
req.session.authenticated = false;

if (!req.isSocket) {
  res.redirect(req.query.next || &#x27;/&#x27;);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.AuthController.provider" id="apidoc.element.sails-auth.AuthController.provider">
        function <span class="apidocSignatureSpan">sails-auth.AuthController.</span>provider
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">provider = function (req, res) {
  sails.services.passport.endpoint(req, res);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.AuthService" id="apidoc.module.sails-auth.AuthService">module sails-auth.AuthService</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.AuthService.buildCallbackNextUrl" id="apidoc.element.sails-auth.AuthService.buildCallbackNextUrl">
        function <span class="apidocSignatureSpan">sails-auth.AuthService.</span>buildCallbackNextUrl
        <span class="apidocSignatureSpan">(req)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">buildCallbackNextUrl = function (req) {
  var url = req.query.next;
  var includeToken = req.query.includeToken;
  var accessToken = _.get(req, &#x27;session.tokens.accessToken&#x27;);

  if (includeToken &#x26;&#x26; accessToken) {
    return url + &#x27;?access_token=&#x27; + accessToken;
  }
  else {
    return url;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }

    req.session.authenticated = true;

    // Upon successful login, optionally redirect the user if there is a
    // `next` query param
    if (req.query.next) {
      var url = sails.services.authservice.<span class="apidocCodeKeywordSpan">buildCallbackNextUrl</span>(req);
      res.status(302).set(&#x27;Location&#x27;, url);
    }

    sails.log.info(&#x27;user&#x27;, user, &#x27;authenticated successfully&#x27;);
    return res.json(user);
  });
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.Passport" id="apidoc.module.sails-auth.Passport">module sails-auth.Passport</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.Passport.beforeCreate" id="apidoc.element.sails-auth.Passport.beforeCreate">
        function <span class="apidocSignatureSpan">sails-auth.Passport.</span>beforeCreate
        <span class="apidocSignatureSpan">(passport, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">beforeCreate = function (passport, next) {
  hashPassword(passport, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.Passport.beforeUpdate" id="apidoc.element.sails-auth.Passport.beforeUpdate">
        function <span class="apidocSignatureSpan">sails-auth.Passport.</span>beforeUpdate
        <span class="apidocSignatureSpan">(passport, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">beforeUpdate = function (passport, next) {
  hashPassword(passport, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.SAError" id="apidoc.module.sails-auth.SAError">module sails-auth.SAError</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.SAError.SAError" id="apidoc.element.sails-auth.SAError.SAError">
        function <span class="apidocSignatureSpan">sails-auth.</span>SAError
        <span class="apidocSignatureSpan">(properties)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SAError(properties) {

  // Call superclass (Error)
  SAError.super_.call(this, properties);

  // Merge the properties into the error instance
  properties || (properties = { });
  _.extend(this, properties);

  // Customize the `reason` based on the # of invalid attributes
  // (`reason` may not be overridden)
  var isSingular = this.length === 1;
  this.reason = util.format(&#x27;%d attribute%s %s invalid&#x27;,
    this.length,
    isSingular ? &#x27;&#x27; : &#x27;s&#x27;,
    isSingular ? &#x27;is&#x27; : &#x27;are&#x27;);

  // Always apply the &#x27;E_VALIDATION&#x27; error code, even if it was overridden.
  this.code = &#x27;E_VALIDATION&#x27;;

  // Status may be overridden.
  this.status = properties.status || 400;

  if (this.originalError) {
    if (this.originalError.invalidAttributes) {
      this.invalidAttributes = _.mapValues(this.originalError.invalidAttributes, function(n, k) {
        return _.map(n, function(i) {
          // Set a new message if we have one
          if (_.has(errors, [k, i.rule])) {
            i.message = errors[k][i.rule];
          }

          // Remove all elements but the message
          _.forEach(_.without(_.keys(i), &#x27;message&#x27;), function(key) {
            delete i[key];
          })

          return i;
        })

        return n;
      });
    }

  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.SAError.super_" id="apidoc.element.sails-auth.SAError.super_">
        function <span class="apidocSignatureSpan">sails-auth.SAError.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Error() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.SAError.prototype" id="apidoc.module.sails-auth.SAError.prototype">module sails-auth.SAError.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.SAError.prototype.toJSON" id="apidoc.element.sails-auth.SAError.prototype.toJSON">
        function <span class="apidocSignatureSpan">sails-auth.SAError.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function () {
  var obj = {
    status: this.status,
    summary: this.summary,
    invalidAttributes: this.invalidAttributes
  };


  return obj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.SAError.prototype.toPOJO" id="apidoc.element.sails-auth.SAError.prototype.toPOJO">
        function <span class="apidocSignatureSpan">sails-auth.SAError.prototype.</span>toPOJO
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toPOJO = function () {
  var obj = {
    status: this.status,
    summary: this.summary,
    invalidAttributes: this.invalidAttributes
  };


  return obj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.User" id="apidoc.module.sails-auth.User">module sails-auth.User</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.User.beforeCreate" id="apidoc.element.sails-auth.User.beforeCreate">
        function <span class="apidocSignatureSpan">sails-auth.User.</span>beforeCreate
        <span class="apidocSignatureSpan">(user, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">beforeCreate = function (user, next) {
  if (_.isEmpty(user.username)) {
    user.username = user.email;
  }
  next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.User.register" id="apidoc.element.sails-auth.User.register">
        function <span class="apidocSignatureSpan">sails-auth.User.</span>register
        <span class="apidocSignatureSpan">(user)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">register = function (user) {
  return new Promise(function (resolve, reject) {
    sails.services.passport.protocols.local.createUser(user, function (error, created) {
      if (error) return reject(error);

      resolve(created);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */

module.exports = {
/**
 * @override
 */
create: function (req, res, next) {
  sails.services.passport.protocols.local.<span class="apidocCodeKeywordSpan">register</span>(req.body, function (err, user) {
    if (err) return res.negotiate(err);

    res.ok(user);
  });
},

me: function (req, res) {
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.UserController" id="apidoc.module.sails-auth.UserController">module sails-auth.UserController</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.UserController.create" id="apidoc.element.sails-auth.UserController.create">
        function <span class="apidocSignatureSpan">sails-auth.UserController.</span>create
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (req, res, next) {
  sails.services.passport.protocols.local.register(req.body, function (err, user) {
    if (err) return res.negotiate(err);

    res.ok(user);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param {String}   password
 * @param {Function} next
 */
exports.createUser = function (_user, next) {
  var password = _user.password;
  delete _user.password;

  return sails.models.user.<span class="apidocCodeKeywordSpan">create</span>(_user, function (err, user) {
    if (err) {
sails.log(err);

if (err.code === &#x27;E_VALIDATION&#x27;) {
  return next(new SAError({originalError: err}));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.UserController.me" id="apidoc.element.sails-auth.UserController.me">
        function <span class="apidocSignatureSpan">sails-auth.UserController.</span>me
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">me = function (req, res) {
  res.ok(req.user);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.index" id="apidoc.module.sails-auth.index">module sails-auth.index</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.index.basic" id="apidoc.element.sails-auth.index.basic">
        function <span class="apidocSignatureSpan">sails-auth.index.</span>basic
        <span class="apidocSignatureSpan">(req, username, password, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">basic = function (req, username, password, next) {
  sails.log(&#x27;using basic auth strategy for user&#x27;, username, &#x27;, password&#x27;, password);

  return localProtocol.login(req, username, password, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.index.oauth" id="apidoc.element.sails-auth.index.oauth">
        function <span class="apidocSignatureSpan">sails-auth.index.</span>oauth
        <span class="apidocSignatureSpan">(req, token, tokenSecret, profile, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">oauth = function (req, token, tokenSecret, profile, next) {
  var query    = {
      identifier : profile.id
    , protocol   : &#x27;oauth&#x27;
    , tokens     : { token: token }
    };

  if (tokenSecret !== undefined) {
    query.tokens.tokenSecret = tokenSecret;
  }

  sails.services.passport.connect(req, query, profile, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.index.oauth2" id="apidoc.element.sails-auth.index.oauth2">
        function <span class="apidocSignatureSpan">sails-auth.index.</span>oauth2
        <span class="apidocSignatureSpan">(req, accessToken, refreshToken, profile, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">oauth2 = function (req, accessToken, refreshToken, profile, next) {
  var query = {
    identifier: profile.id,
    protocol: &#x27;oauth2&#x27;,
    tokens: { accessToken: accessToken }
  };

  if (!_.isUndefined(refreshToken)) {
    query.tokens.refreshToken = refreshToken;
  }

  sails.services.passport.connect(req, query, profile, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.index.openid" id="apidoc.element.sails-auth.index.openid">
        function <span class="apidocSignatureSpan">sails-auth.index.</span>openid
        <span class="apidocSignatureSpan">(req, identifier, profile, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">openid = function (req, identifier, profile, next) {
  var query    = {
    identifier : identifier
  , protocol   : &#x27;openid&#x27;
  };

  sails.services.passport.connect(req, query, profile, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-auth.local" id="apidoc.module.sails-auth.local">module sails-auth.local</a></h1>


    <h2>
        <a href="#apidoc.element.sails-auth.local.connect" id="apidoc.element.sails-auth.local.connect">
        function <span class="apidocSignatureSpan">sails-auth.local.</span>connect
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (req, res, next) {
  var user     = req.user
    , password = req.param(&#x27;password&#x27;)
    , Passport = sails.models.passport;

  Passport.findOne({
    protocol : &#x27;local&#x27;
  , user     : user.id
  }, function (err, passport) {
    if (err) {
      return next(err);
    }

    if (!passport) {
      Passport.create({
        protocol : &#x27;local&#x27;
      , password : password
      , user     : user.id
      }, function (err, passport) {
        next(err, user);
      });
    }
    else {
      next(null, user);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    tokens: { accessToken: accessToken }
  };

  if (!_.isUndefined(refreshToken)) {
    query.tokens.refreshToken = refreshToken;
  }

  sails.services.passport.<span class="apidocCodeKeywordSpan">connect</span>(req, query, profile, next);
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.local.createUser" id="apidoc.element.sails-auth.local.createUser">
        function <span class="apidocSignatureSpan">sails-auth.local.</span>createUser
        <span class="apidocSignatureSpan">(_user, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createUser = function (_user, next) {
  var password = _user.password;
  delete _user.password;

  return sails.models.user.create(_user, function (err, user) {
    if (err) {
      sails.log(err);

      if (err.code === &#x27;E_VALIDATION&#x27;) {
        return next(new SAError({originalError: err}));
      }

      return next(err);
    }

    sails.models.passport.create({
      protocol : &#x27;local&#x27;
    , password : password
    , user     : user.id
    }, function (err, passport) {
      if (err) {
        if (err.code === &#x27;E_VALIDATION&#x27;) {
          err = new SAError({originalError: err});
        }

        return user.destroy(function (destroyErr) {
          next(destroyErr || err);
        });
      }

      next(null, user);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  },

  /**
   * Register a new User with a passport
   */
  register: function (user) {
    return new Promise(function (resolve, reject) {
      sails.services.passport.protocols.local.<span class="apidocCodeKeywordSpan">createUser</span>(user, function (error, created
) {
        if (error) return reject(error);

        resolve(created);
      });
    });
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.local.login" id="apidoc.element.sails-auth.local.login">
        function <span class="apidocSignatureSpan">sails-auth.local.</span>login
        <span class="apidocSignatureSpan">(req, identifier, password, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">login = function (req, identifier, password, next) {
  var isEmail = validateEmail(identifier)
    , query   = {};

  if (isEmail) {
    query.email = identifier;
  }
  else {
    query.username = identifier;
  }

  sails.models.user.findOne(query, function (err, user) {
    if (err) {
      return next(err);
    }

    if (!user) {
      if (isEmail) {
        req.flash(&#x27;error&#x27;, &#x27;Error.Passport.Email.NotFound&#x27;);
      } else {
        req.flash(&#x27;error&#x27;, &#x27;Error.Passport.Username.NotFound&#x27;);
      }

      return next(null, false);
    }

    sails.models.passport.findOne({
      protocol : &#x27;local&#x27;
    , user     : user.id
    }, function (err, passport) {
      if (passport) {
        passport.validatePassword(password, function (err, res) {
          if (err) {
            return next(err);
          }

          if (!res) {
            req.flash(&#x27;error&#x27;, &#x27;Error.Passport.Password.Wrong&#x27;);
            return next(null, false);
          } else {
            return next(null, user, passport);
          }
        });
      }
      else {
        req.flash(&#x27;error&#x27;, &#x27;Error.Passport.Password.NotSet&#x27;);
        return next(null, false);
      }
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    sails.services.passport.callback(req, res, function (err, user) {
      if (err || !user) {
sails.log.warn(user, err);
return negotiateError(err);
      }

      req.<span class="apidocCodeKeywordSpan">login</span>(user, function (err) {
if (err) {
  sails.log.warn(err);
  return negotiateError(err);
}

req.session.authenticated = true;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-auth.local.register" id="apidoc.element.sails-auth.local.register">
        function <span class="apidocSignatureSpan">sails-auth.local.</span>register
        <span class="apidocSignatureSpan">(user, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">register = function (user, next) {
  exports.createUser(user, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */

module.exports = {
/**
 * @override
 */
create: function (req, res, next) {
  sails.services.passport.protocols.local.<span class="apidocCodeKeywordSpan">register</span>(req.body, function (err, user) {
    if (err) return res.negotiate(err);

    res.ok(user);
  });
},

me: function (req, res) {
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
